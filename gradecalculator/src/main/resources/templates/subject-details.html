<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Subject Details</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f4f7f6; display: flex; justify-content: center; }
        .container { width: 80%; margin-top: 50px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #429d8f; padding-bottom: 10px; margin-bottom: 20px; }
        h1 { color: #2c3e50; margin: 0; }
        
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #2c3e50; color: white; }
        
        .back-btn { background: #95a5a6; color: white; text-decoration: none; padding: 10px 20px; border-radius: 5px; font-weight: bold; }
        .add-form { margin-top: 20px; padding: 20px; background: #ecf0f1; border-radius: 8px; display: flex; gap: 10px; flex-wrap: wrap;}
        input { padding: 10px; border: 1px solid #ccc; border-radius: 5px; flex: 1; }
        button { padding: 10px 20px; background-color: #27ae60; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1 id="subject-title">Loading...</h1>
        <a href="dashboard.html" class="back-btn">‚Üê Back to Dashboard</a>
    </div>

    <table>
        <thead>
            <tr>
                <th>Assignment Name</th>
                <th>Weight (%)</th>
                <th>Score</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody id="comp-table-body"></tbody>
    </table>
	<div style="margin-top: 40px; background: #fff; padding: 20px; border-radius: 10px; border: 2px solid #2c3e50;">
	    <h2 style="margin-top:0;">Target Grade Calculator üßÆ</h2>
	    <p>What grade do you want in this class?</p>
	        
	    <div style="display: flex; gap: 10px; align-items: center;">
	        <input type="number" id="targetGrade" placeholder="Enter target (e.g. 93.0)" style="max-width: 150px;">
	        <button onclick="calculateTarget()" style="background-color: #8e44ad;">Calculate Needed Score</button>
	    </div>

	    <h3 id="calc-result" style="color: #2c3e50; margin-top: 20px;"></h3>
	</div>
	
    <div class="add-form">
        <input type="text" id="cName" placeholder="Name (e.g. Midterm)">
        <input type="number" id="cWeight" placeholder="Weight %">
        <input type="number" id="cScore" placeholder="Score">
        <input type="number" id="cTotal" placeholder="Total Points">
        <button onclick="addComponent()">+ Add Grade</button>
    </div>
</div>

<script>
    // 1. Get Subject ID from URL (e.g. subject-details.html?id=1)
    const urlParams = new URLSearchParams(window.location.search);
    const subjectId = urlParams.get('id');

    window.onload = function() {
        if(!subjectId) { alert("No Subject Selected!"); return; }
        loadComponents();
    };

    function loadComponents() {
        // Fetch the list of components for this subject
        fetch(`/api/components/list?subjectId=${subjectId}`)
            .then(res => res.json())
            .then(data => {
                const tbody = document.getElementById('comp-table-body');
                tbody.innerHTML = "";
                document.getElementById('subject-title').innerText = "Subject Details (ID: " + subjectId + ")";

                data.forEach(comp => {
                    let row = `<tr>
                        <td>${comp.componentName}</td>
                        <td>${comp.weightage}%</td>
                        <td>${comp.pointsScored}</td>
                        <td>${comp.totalPoints}</td>
                    </tr>`;
                    tbody.innerHTML += row;
                });
            });
    }

    function addComponent() {
        let name = document.getElementById('cName').value;
        let weight = document.getElementById('cWeight').value;
        let score = document.getElementById('cScore').value;
        let total = document.getElementById('cTotal').value;

        // Call your Java API
        fetch(`/api/components/add?subjectId=${subjectId}&name=${name}&weight=${weight}&score=${score}&total=${total}`)
            .then(res => res.text())
            .then(msg => {
                alert(msg);
                loadComponents(); // Refresh list
                // Clear inputs
                document.getElementById('cName').value = "";
                document.getElementById('cScore').value = "";
            });
    }
	
	function calculateTarget() {
	        let target = document.getElementById('targetGrade').value;
	        if (!target) {
	            alert("Please enter a target grade!");
	            return;
	        }

	        // Call the Calculation API
	        fetch(`/api/subjects/calculate?id=${subjectId}&target=${target}`)
	            .then(response => response.text())
	            .then(result => {
	                // Display result nicely
	                let resultBox = document.getElementById('calc-result');
	                resultBox.innerText = result;
	                
	                // Color code the result (Red = Impossible, Green = Safe)
	                if(result.includes("Impossible")) {
	                    resultBox.style.color = "#c0392b"; // Red
	                } else if (result.includes("secured")) {
	                    resultBox.style.color = "#27ae60"; // Green
	                } else {
	                    resultBox.style.color = "#d35400"; // Orange
	                }
	            });
	    }
</script>

</body>
</html>